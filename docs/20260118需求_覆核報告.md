# 20260118éœ€æ±‚è¦†æ ¸å ±å‘Šï¼ˆå°ç…§ `docs/20260118éœ€æ±‚.md`ï¼‰

> ç›®çš„ï¼šä¾æ“š `docs/20260118éœ€æ±‚.md` çš„æ–‡å­—æè¿°ï¼Œè¦†æ ¸ç›®å‰å°ˆæ¡ˆæ˜¯å¦å·²åƒè€ƒä¸¦å®Œæˆç›¸å°æ‡‰éœ€æ±‚ï¼›è‹¥æœ‰ä¸ä¸€è‡´ã€èªæ„ç–‘æ…®æˆ–ç¼ºå£ï¼Œå¿…é ˆæ˜ç¢ºåˆ—å‡ºã€‚
>
> è¦†æ ¸æ—¥æœŸï¼š2026-01-18

---

## ä¸€ã€è¦†æ ¸ç¯„åœèˆ‡æ–¹æ³•

### è¦†æ ¸ç¯„åœ

- **DGCN3ï¼ˆä¸­å¿ƒæ€§é æ¸¬ï¼‰è¼¸å‡º**ï¼šæ˜¯å¦èƒ½é‡å° Tiage 10 å€‹æ™‚é–“ç‰‡è¼¸å‡ºä¸­å¿ƒæ€§ CSVï¼Œä¸”æ ¼å¼ç¬¦åˆéœ€æ±‚ï¼ˆç„¡è¡¨é ­ã€å…©æ¬„ï¼šnode_idã€é æ¸¬ä¸­å¿ƒæ€§ï¼‰ã€‚
- **TAKEï¼ˆè©±é¡Œè½‰ç§»æª¢æ¸¬ï¼‰è¼¸å…¥**ï¼šæ˜¯å¦æŠŠã€Œå¥å­ embedding + ç¯€é»ä¸­å¿ƒæ€§ + æ‰€å±¬ç¤¾åœ˜ã€ç´å…¥åˆ¤åˆ¥å™¨ä½¿ç”¨ã€‚
- **TAKE è¼¸å‡ºèˆ‡è½æª”**ï¼ˆä»¥ä½¿ç”¨è€…æœ€æ–°éœ€æ±‚æè¿°ç‚ºæº–ï¼‰ï¼š
  - æ˜¯å¦èƒ½**ä¿å­˜æ¯ä¸€å¥è©±çš„ shift é æ¸¬æ¨™ç±¤**ï¼ˆ0=ä¸è½‰ç§»ã€1=è½‰ç§»ï¼‰
  - è‹¥ç™¼ç”Ÿè½‰ç§»ï¼šæ˜¯å¦èƒ½ç”¢ç”Ÿä¸€ä»½**ç›´æ¥å¯«å…¥æ–‡å­—æª”çš„ã€Œå›ç­”ã€**ï¼ŒåŒ…å«ï¼š
    - ç™¼ç”Ÿè½‰ç§»çš„å¥å­
    - è©²è½‰ç§»å¥å­çš„ä¸­å¿ƒæ€§
    - å¾ã€Œå‰ä¸€æ¬¡ç™¼ç”Ÿè©±é¡Œè½‰ç§»ã€åˆ°ã€Œé€™æ¬¡è©±é¡Œè½‰ç§»ã€çš„å€é–“å…§ï¼Œä¸­å¿ƒæ€§ Top-3 å¥å­ï¼ˆç”¨ä¾†è¡¡é‡é—œéµè³‡è¨Šï¼‰
    - ä¸¦åŠ å…¥æ›´å¤šå®šä½è³‡è¨Šï¼ˆè‡³å°‘ `turn_id`ã€`query_id`ï¼‰ä»¥ä¾¿å›æº¯åˆ°åŸå§‹è³‡æ–™åˆ—
  - æ‰€æœ‰è¼¸å‡ºçµæœéœ€ä¿å­˜åˆ°æª”æ¡ˆ
- **è©•åƒ¹æŒ‡æ¨™**ï¼šæ˜¯å¦è¼¸å‡ºä¸¦è½æª” Precision / Recall / F1ï¼ˆä»¥ shift ç‚ºç›®æ¨™ï¼‰ã€‚

### è¦†æ ¸æ–¹æ³•ï¼ˆå¯ç¨½æ ¸ï¼‰

- ä»¥éœ€æ±‚æ–‡æª”æ¢ç›®ç‚ºä¸»ï¼Œå°ç…§ç¾æœ‰**è…³æœ¬å…¥å£**ã€**è³‡æ–™è¼‰å…¥å™¨**ã€**æ¨¡å‹**ã€**æ¨è«–/è©•ä¼°è¼¸å‡º**ã€‚
- æ¯å€‹æ¢ç›®è‡³å°‘çµ¦å‡ºä¸€å€‹ã€Œå¯å®šä½çš„è­‰æ“šã€ï¼šæª”æ¡ˆè·¯å¾‘ + é—œéµè¡Œç‚ºæè¿°ï¼ˆå¿…è¦æ™‚æŒ‡å‡ºè¼¸å‡ºæª”æ¡ˆä½ç½®èˆ‡æª”åè¦å‰‡ï¼‰ã€‚

---

## äºŒã€éœ€æ±‚æ‹†è§£ï¼ˆä»¥ `docs/20260118éœ€æ±‚.md` ç‚ºæº–ï¼‰

> æœ¬ç¯€å·²åˆä½µä½¿ç”¨è€…æ–¼å°è©±ä¸­è£œå……çš„ã€Œç¢ºèªç‰ˆã€è¦æ ¼ï¼›è‹¥èˆ‡ `docs/20260118éœ€æ±‚.md` åŸæ–‡æœ‰å‡ºå…¥ï¼Œä»¥æœ¬ç¯€æ¨™è¨»ã€Œï¼ˆå·²ç¢ºèªï¼‰ã€è€…ç‚ºæº–ã€‚

### éœ€æ±‚ R1ï¼šDGCN3 ä¸­å¿ƒæ€§é æ¸¬èˆ‡è¼¸å‡ºæ ¼å¼

- **R1-1**ï¼šé‡å° Tiage å‹•æ…‹ç¶²è·¯ï¼ˆ10 å€‹æ™‚é–“ç‰‡ï¼‰è¼¸å‡ºä¸­å¿ƒæ€§é æ¸¬ã€‚
- **R1-2**ï¼šè¼¸å‡ºä½ç½®ï¼š`demo/DGCN3/Centrality/`ï¼ˆä¾ä½¿ç”¨è€…è£œå……ï¼šDGCN3 è¼¸å‡ºæ–‡æª”åœ¨ `demo\DGCN3\Centrality`ï¼‰ã€‚
- **R1-3**ï¼šè¼¸å‡ºæ ¼å¼ï¼šæ¯å€‹æ™‚é–“ç‰‡ä¸€å€‹ CSVï¼›ç¬¬ 1 æ¬„ node_idã€ç¬¬ 2 æ¬„é æ¸¬ä¸­å¿ƒæ€§ï¼›**ä¸éœ€è¦åˆ—åï¼ˆheaderï¼‰**ã€‚
- **R1-4**ï¼šéœ€æ±‚æ–‡æª”è¨»è¨˜ã€Œç›®å‰åªè¼¸å‡ºæ¸¬è©¦é›† (7,8,9)ï¼Œéœ€æ“´å±•ç‚ºè¼¸å‡ºæ‰€æœ‰æ™‚é–“ç‰‡ã€ã€‚
- **R1-5ï¼ˆå»¶ä¼¸ï¼‰**ï¼šSIR åƒæ•¸ alpha éœ€å¯èª¿æ•´ï¼ˆå…ˆç”¨ 1.5ï¼Œä¸¦æåŠ 1.0â€“1.9 å¯æ¸¬ï¼‰ã€‚

### éœ€æ±‚ R2ï¼šTAKE è¼¸å…¥éœ€ç´å…¥ä¸­å¿ƒæ€§ + ç¤¾åœ˜

- **R2-1**ï¼šå°ä»»æ„ä¸€å¥è©±ï¼ˆç¯€é»ï¼‰æä¾›å¥å­ embeddingï¼ˆåŸ TAKE æ—¢æœ‰ï¼‰ã€‚
- **R2-2**ï¼šæä¾›è©²ç¯€é»ä¸­å¿ƒæ€§ï¼ˆç”± DGCN3 é æ¸¬åŒ¯å…¥ï¼‰ã€‚
- **R2-3**ï¼šæä¾›è©²ç¯€é»æ‰€å±¬ç¤¾åœ˜ï¼ˆcommunityï¼‰ã€‚
- **R2-4**ï¼šä¸Šè¿°ç‰¹å¾µå…±åŒè¼¸å…¥ TAKE åˆ¤åˆ¥å™¨ï¼ˆä¸­é–“æ¨¡çµ„ï¼‰åˆ¤æ–·æ˜¯å¦è©±é¡Œè½‰ç§»ã€‚

### éœ€æ±‚ R3ï¼šTAKE è¼¸å‡ºå…§å®¹èˆ‡è½æª”

- **R3-1ï¼ˆå·²ç¢ºèªï¼‰**ï¼šè¼¸å‡ºæ˜¯å¦ç™¼ç”Ÿè©±é¡Œè½‰ç§»ï¼ˆbinaryï¼‰ï¼Œä¸¦ä¸”ä¿å­˜**æ¯ä¸€å¥è©±**é æ¸¬çš„æ¨™ç±¤ï¼š
  - **0 è¡¨ç¤ºè©±é¡Œä¸è½‰ç§»**
  - **1 è¡¨ç¤ºè©±é¡Œè½‰ç§»**
- **R3-2ï¼ˆå·²ç¢ºèªï¼‰**ï¼šè‹¥ç™¼ç”Ÿï¼šå‰‡ã€Œæ¯å€‹ shift äº‹ä»¶ã€ç”¨ **GPT-2** ç”Ÿæˆå›ç­”ï¼Œå›ç­”ç›´æ¥å¯«åœ¨æ–‡å­—æª”ä¸­ï¼Œä¸”æ¯å€‹ shift äº‹ä»¶è‡³å°‘åŒ…å«ï¼š
  - ç™¼ç”Ÿè½‰ç§»çš„å¥å­
  - è©²è½‰ç§»å¥å­çš„ä¸­å¿ƒæ€§
  - **ä¸­å¿ƒæ€§ Top-3 å¥å­ï¼ˆå€é–“å®šç¾©å·²ç¢ºèªï¼‰**ï¼š
    - ç¬¬ä¸€æ¬¡å‡ºç¾ shiftï¼šå€é–“å¾**å°è©±é–‹é ­**ç®—èµ·
    - å…¶é¤˜ shiftï¼šå€é–“ç‚ºã€Œå‰ä¸€æ¬¡ shiftã€åˆ°ã€Œæœ¬æ¬¡ shiftã€ä¹‹é–“ï¼ˆåŒä¸€å°è©±å…§ï¼‰
  - **å®šä½è³‡è¨Šï¼ˆå·²ç¢ºèªï¼‰**ï¼š`turn_id`ï¼ˆä»¥ `demo/tiage-1/outputs_nodes/tiage_anno_nodes_all.csv` çš„ `turn_id` ç‚ºæº–ï¼‰ä»¥ä¾¿å›æº¯åŸå§‹è³‡æ–™åˆ—
- **R3-3ï¼ˆå·²ç¢ºèªï¼‰**ï¼šæ‰€æœ‰è¼¸å‡ºçµæœéœ€è¦ä¿å­˜åˆ°æª”æ¡ˆï¼ˆé€å¥æ¨™ç±¤æª” + æ¯å€‹ shift äº‹ä»¶çš„å›ç­”æ–‡å­—æª” + æŒ‡æ¨™ç­‰ï¼‰ã€‚

### éœ€æ±‚ R4ï¼šåŠ ä¸Š shift è©•åƒ¹æŒ‡æ¨™ï¼ˆPrecision / Recall / F1ï¼‰

- **R4-1**ï¼šè¼¸å‡º Precisionï¼ˆé æ¸¬ç‚º shift çš„ï¼Œå¤šå°‘ç‚ºçœŸ shiftï¼‰ã€‚
- **R4-2**ï¼šè¼¸å‡º Recallï¼ˆæ‰€æœ‰çœŸ shift ä¸­ï¼Œæ‰¾å›å¤šå°‘ï¼‰ã€‚
- **R4-3**ï¼šè¼¸å‡º F1ï¼ˆPrecision èˆ‡ Recall å¹³è¡¡ï¼‰ã€‚
- **R4-4**ï¼šä¿å­˜è©•åƒ¹æŒ‡æ¨™ï¼ˆéœ€æ±‚æ–‡æª”å¯«ã€Œä¿æŒè¯„ä»·æŒ‡æ ‡ã€ï¼Œè¦–ç‚ºéœ€è½æª”ä¸¦å¯å›æº¯ï¼‰ã€‚

---

## ä¸‰ã€ç¾æ³æ¶æ§‹èˆ‡è³‡æ–™æµï¼ˆMermaidï¼‰

### 3.1 ä¸€éµæµç¨‹ï¼ˆç¾æ³ï¼‰

```mermaid
flowchart TD
  A[Tiage åŸå§‹æ–‡æœ¬/å°è©±] --> B[demo/tiage-1/export_take_dataset.py<br/>ç”¢ç”Ÿ TAKE æ ¼å¼è³‡æ–™ + node_id.json]
  A2[Tiage å‹•æ…‹ç¶²è·¯ 10 slices<br/>demo/DGCN3/datasets/raw_data/tiage] --> C[dgcn3_export_predictions.py<br/>é€ slice é æ¸¬ä¸­å¿ƒæ€§]
  C --> D[demo/DGCN3/Centrality/alpha_*/tiage_{slice}.csv]
  D --> E[knowSelect/TAKE/CentralityLoader.py<br/>è¼‰å…¥ä¸­å¿ƒæ€§ + Louvain ç¤¾åœ˜ + 6 ç¶­ç‰¹å¾µ]
  B --> F[knowSelect/TAKE/Run.py + Dataset.py<br/>æŠŠ node_ids æ”¾é€² batch]
  E --> G[knowSelect/TAKE/Model.py<br/>ä¸­å¿ƒæ€§/ç¤¾åœ˜ç·¨ç¢¼å¾Œé€²å…¥ TopicShift Discriminator]
  F --> G
  G --> H[knowSelect/output/<name>/metrics/<br/>shift_metrics.json / shift_top3.jsonl / ablation_results.csv]
  G --> I[knowSelect/output/<name>/ks_pred/<epoch>_ks_pred.json]
```

---

## å››ã€éœ€æ±‚ç¬¦åˆæ€§çŸ©é™£ï¼ˆå«è­‰æ“šï¼‰

> ç‹€æ…‹å®šç¾©ï¼šâœ… å·²ç¬¦åˆï¼ğŸŸ¡ éƒ¨åˆ†ç¬¦åˆï¼ˆæœ‰èªæ„æˆ–é‚Šç•Œç–‘æ…®ï¼‰ï¼âŒ æœªç¬¦åˆï¼âš ï¸ éœ€é‡æ¸…ï¼ˆéœ€æ±‚æè¿°ä¸è¶³ä»¥å”¯ä¸€åˆ¤å®šï¼‰

| éœ€æ±‚ | ç‹€æ…‹ | å°ˆæ¡ˆè­‰æ“šï¼ˆæª”æ¡ˆ/è¡Œç‚ºï¼‰ | èªªæ˜èˆ‡ç–‘æ…® |
|---|---|---|---|
| R1-1ï¼ˆ10 å€‹æ™‚é–“ç‰‡è¼¸å‡ºï¼‰ | âœ… | `dgcn3_export_predictions.py`ï¼š`timesteps = list(range(len(dataset)))` ä¸¦é€ä¸€è¼¸å‡º `tiage_{t}.csv` | å·²è¦†è“‹æ‰€æœ‰ time slicesï¼ˆé€šå¸¸ç‚º 0â€“9ï¼‰ã€‚ |
| R1-2ï¼ˆè¼¸å‡ºè·¯å¾‘ï¼‰ | âœ… | `dgcn3_export_predictions.py` é è¨­è¼¸å‡ºåˆ° `demo/DGCN3/Centrality/alpha_<alpha>/tiage_{t}.csv` | å·²ç¬¦åˆä½ è£œå……çš„è·¯å¾‘å®šç¾©ã€‚ |
| R1-3ï¼ˆCSV æ ¼å¼ï¼šå…©æ¬„ã€ç„¡è¡¨é ­ï¼‰ | âœ… | `dgcn3_export_predictions.py` ä½¿ç”¨ `to_csv(index=False, header=False)`ï¼Œæ¬„ä½ç‚º node_idã€centrality | ç¬¦åˆã€Œä¸éœ€è¦åˆ—åã€å…©æ¬„ã€è¦æ±‚ã€‚ |
| R1-4ï¼ˆä¿®æ­£åªè¼¸å‡º 7â€“9 çš„é™åˆ¶ï¼‰ | âœ… | `dgcn3_export_predictions.py` é€ slice é æ¸¬ï¼Œéåƒ…æ¸¬è©¦é›† | éœ€æ±‚æ–‡æª”ä¸­çš„ã€Œç›®å‰ç‹€æ…‹ã€åœ¨æ­¤å°ˆæ¡ˆå·²è¢«ä¿®æ­£ã€‚ |
| R1-5ï¼ˆalpha å¯èª¿ï¼‰ | âœ… | `dgcn3_export_predictions.py --alphas 1.5`ï¼ˆå¯é€—è™Ÿå¤šå€¼ï¼‰ï¼›`main.py export-centrality --alphas ...` | å·²æ”¯æ´å¤š alphaï¼›å°šæœªæä¾›ã€Œ1.0â€“1.9 é€æ­¥æƒæã€çš„å°ˆç”¨åƒæ•¸ï¼ˆå±¬å¯æ”¹é€²ä½†éç¡¬éœ€æ±‚ï¼‰ã€‚ |
| R2-1ï¼ˆå¥å­ embeddingï¼‰ | âœ… | TAKE åŸç”Ÿä»¥ Transformer/BERT encoder ç”¢ç”Ÿè¡¨ç¤ºï¼ˆ`knowSelect/TAKE/Model.py`ï¼‰ | ç¬¦åˆï¼ˆå±¬ TAKE æ—¢æœ‰èƒ½åŠ›ï¼‰ã€‚ |
| R2-2ï¼ˆä¸­å¿ƒæ€§ç‰¹å¾µé€²åˆ¤åˆ¥å™¨ï¼‰ | âœ… | `knowSelect/TAKE/Model.py`ï¼šå¾ `data["node_ids"]` å–ç‰¹å¾µï¼Œç¶“ `CentralityCommunityEncoder` æ³¨å…¥ discriminator fusion | å·²æŠŠä¸­å¿ƒæ€§ç‰¹å¾µç´å…¥ Teacher/Student TopicShiftDiscriminatorã€‚ |
| R2-3ï¼ˆç¤¾åœ˜ç‰¹å¾µé€²åˆ¤åˆ¥å™¨ï¼‰ | âœ… | `knowSelect/TAKE/CentralityLoader.py` ä½¿ç”¨ Louvainï¼ˆ`community_louvain.best_partition`ï¼‰è¨ˆç®—ç¤¾åœ˜ï¼Œä¸¦ä»¥ embedding æ³¨å…¥ | å·²ç´å…¥ã€‚ |
| R2-4ï¼ˆå…±åŒè¼¸å…¥ TAKE åˆ¤åˆ¥å™¨ï¼‰ | âœ… | `knowSelect/TAKE/Model.py` åœ¨ forward å‘¼å« discriminator æ™‚å‚³å…¥ `centrality_features` èˆ‡ `community_ids` | å·²ç´å…¥ã€‚ |
| R3-1ï¼ˆè¼¸å‡ºæ˜¯å¦ shiftï¼‰ | âœ… | `knowSelect/TAKE/CumulativeTrainer.py`ï¼šæ¯å€‹ dialog è¨˜éŒ„ `shift_found`ï¼Œè½æª”è‡³ `metrics/shift_top3.jsonl` | å·²æœ‰ per-dialog çš„ shift_foundï¼ˆæ¨è«–çµæœï¼‰ã€‚ |
| R3-1ï¼ˆé€å¥ shift 0/1 æ¨™ç±¤è½æª”ï¼‰ | âœ… | `knowSelect/TAKE/CumulativeTrainer.py` æ–¼ `metrics/shift_pred.jsonl` è¿½åŠ è¼¸å‡ºé€å¥é æ¸¬ï¼ˆå« `turn_id`ï¼‰ | å·²æ–°å¢ `shift_pred.jsonl`ï¼Œæ¯ç­†è‡³å°‘åŒ…å«ï¼š`dialog_id`ã€`query_id`ã€`turn_id`ã€`node_id`ã€`pred_shift`ã€‚ |
| R3-2ï¼ˆå€é–“ Top-3 + turn_idï¼‰ | âœ… | `knowSelect/TAKE/CumulativeTrainer.py`ï¼š`shift_top3.jsonl` æ¯æ¢è¨˜éŒ„æ–°å¢ `shift_events`ï¼Œæ¯å€‹äº‹ä»¶å« `shift_turn_id` èˆ‡ `interval_top3`ï¼ˆTop-3 å…§å« `turn_id`ï¼‰ | å·²æ”¹ç‚ºã€Œç¬¬ä¸€æ¬¡ shift å¾å°è©±é–‹é ­ã€å…¶é¤˜ä»¥å‰æ¬¡ shift åˆ°æœ¬æ¬¡ shiftã€çš„å€é–“ Top-3ã€‚ |
| R3-3ï¼ˆæ‰€æœ‰è¼¸å‡ºä¿å­˜åˆ°æª”æ¡ˆï¼‰ | âœ… | å·²è½æª”ï¼š`shift_metrics.json`ã€`ablation_results.csv`ã€`shift_top3.jsonl`ã€`shift_pred.jsonl`ã€`shift_answers_<epoch>_<dataset>.txt` | å·²æ–°å¢ GPT-2 å›ç­”æ–‡å­—æª”ç”¢å‡ºï¼ˆ`main.py generate-shift-answers` / `scripts/run_generate_shift_answers_tiage.sh`ï¼‰ã€‚ |
| R4ï¼ˆPrecision/Recall/F1ï¼‰ | âœ… | `knowSelect/TAKE/CumulativeTrainer.py` ä½¿ç”¨ `precision_recall_fscore_support` è¨ˆç®—ä¸¦å¯«å…¥ `metrics/shift_metrics.json` + `ablation_results.csv` | å·²å®Œæˆä¸¦å¯å›æº¯ã€‚ |

---

## äº”ã€é—œéµè½åœ°é»ï¼ˆå¯ç›´æ¥å°ç…§éœ€æ±‚ï¼‰

### 5.1 DGCN3ï¼šè¼¸å‡ºæ‰€æœ‰æ™‚é–“ç‰‡ä¸­å¿ƒæ€§ï¼ˆç¬¦åˆ R1-1/R1-3/R1-4ï¼‰

- **è¼¸å‡ºè…³æœ¬**ï¼š`dgcn3_export_predictions.py`
  - æœƒé€ä¸€é æ¸¬ `t=0..len(dataset)-1` ä¸¦å¯«å…¥ CSV
  - CSV ç„¡è¡¨é ­ã€å…©æ¬„ï¼šnode_idã€centrality
- **ä¸€éµå…¥å£ï¼ˆè…³æœ¬ï¼‰**ï¼š`scripts/run_export_centrality_tiage.sh`
- **å°ˆæ¡ˆ CLI å…¥å£**ï¼š`main.py export-centrality`

### 5.2 TAKEï¼šä¸­å¿ƒæ€§ + ç¤¾åœ˜ç´å…¥åˆ¤åˆ¥å™¨ï¼ˆç¬¦åˆ R2ï¼‰

- **è¼‰å…¥èˆ‡ç‰¹å¾µæ§‹å»º**ï¼š`knowSelect/TAKE/CentralityLoader.py`
  - è¼‰å…¥ä¸­å¿ƒæ€§é æ¸¬ `demo/DGCN3/Centrality/alpha_<alpha>/tiage_<slice>.csv`
  - ç”± edge list åš Louvain å¾—ç¤¾åœ˜
  - ç”¢å‡º 6 ç¶­çµæ§‹ç‰¹å¾µï¼ˆå« rawã€rank_pctã€deltaã€z-score ç­‰ï¼‰
- **æ¨¡å‹æ³¨å…¥**ï¼š`knowSelect/TAKE/Model.py`
  - `CentralityCommunityEncoder` å°‡ï¼ˆ6 ç¶­ç‰¹å¾µ + ç¤¾åœ˜ IDï¼‰ç·¨ç¢¼å¾Œä¸²æ¥åˆ° discriminator çš„ fusion å‘é‡
- **è³‡æ–™æ‰¹æ¬¡æ”œå¸¶ node_id**ï¼š`knowSelect/TAKE/Dataset.py` èˆ‡ `knowSelect/dataset/Utils_TAKE.py`
  - `Utils_TAKE.load_default(..., node_id_json=...)` æœƒæŠŠ `node_id` æ³¨å…¥æ¯å€‹ example
  - `Dataset.collate_fn` å›å‚³ `node_ids` ä¾›æ¨¡å‹ä½¿ç”¨

### 5.3 TAKEï¼šshift è¼¸å‡ºè½æª”èˆ‡ PRF æŒ‡æ¨™ï¼ˆç¬¦åˆ R3-1/R3-3/R4ï¼‰

- **è¨ˆç®— PRF ä¸¦è½æª”**ï¼š`knowSelect/TAKE/CumulativeTrainer.py`
  - å¯«å…¥ `output/<name>/metrics/shift_metrics.json`
  - è¿½åŠ  `output/<name>/metrics/ablation_results.csv`
- **Top-3ï¼ˆç›®å‰å®šç¾©ï¼‰ä¸¦è½æª”**ï¼š`knowSelect/TAKE/CumulativeTrainer.py`
  - è¿½åŠ å¯«å…¥ `output/<name>/metrics/shift_top3.jsonl`
- **å ±å‘Šè®€å–/åŒ¯ç¸½**ï¼š`knowSelect/TAKE/evaluate_topic_shift.py`
  - è®€å–ä¸Šè¿° metrics ä¸¦è¼¸å‡º `evaluation_report.txt`

---

## å…­ã€èˆ‡éœ€æ±‚æ–‡æª”çš„å·®ç•°ã€ç–‘æ…®èˆ‡ç¼ºå£ï¼ˆå¿…è®€ï¼‰

### 6.1 Top-3 çš„å®šç¾©ä¸ç¬¦åˆã€Œå€é–“ Top-3ã€ï¼ˆR3-2ï¼šâœ… å·²ä¿®å¾©ï¼‰

ä¾ä½ æœ€æ–°éœ€æ±‚ï¼ŒTop-3 å¿…é ˆå®šç¾©ç‚ºï¼š

- ä»¥åŒä¸€å°è©±ç‚ºå–®ä½
- æ‰¾åˆ°ã€Œå‰ä¸€æ¬¡ç™¼ç”Ÿè©±é¡Œè½‰ç§»ã€åˆ°ã€Œé€™æ¬¡è©±é¡Œè½‰ç§»ã€çš„ turn å€é–“
- åœ¨è©²å€é–“å…§ï¼ˆå«æˆ–ä¸å«ç«¯é»éœ€å†å›ºå®šè¦å‰‡ï¼‰ä¾ä¸­å¿ƒæ€§æ’åºå–å‰ 3

ç›®å‰å¯¦ä½œç‚ºï¼š

- å…ˆæ‰¾å‡ºã€Œè¢«æ¨¡å‹é æ¸¬ç‚º shiftã€çš„ turn
- åƒ…åœ¨é€™äº› turn ä¸­æ”¶é›†å¥å­èˆ‡ä¸­å¿ƒæ€§
- ä¾ä¸­å¿ƒæ€§æ’åºå–å‰ 3

å·²æ–¼ `knowSelect/TAKE/CumulativeTrainer.py` ä¿®æ­£ç‚ºã€Œå€é–“ Top-3ã€ä¸¦è¼¸å‡ºåˆ° `metrics/shift_top3.jsonl` çš„ `shift_events[*].interval_top3`ã€‚

### 6.2 ç¼ºå°‘ `turn_id` å®šä½è³‡è¨Šï¼ˆR3-2ï¼šâœ… å·²ä¿®å¾©ï¼‰

å·²åœ¨ `shift_top3.jsonl` çš„ Top-3 å¥å­ä¸­åŠ å…¥ `turn_id`ï¼›åŒæ™‚é€å¥é æ¸¬è¼¸å‡º `shift_pred.jsonl` ä¹ŸåŒ…å« `turn_id`ã€‚

### 6.3 ç¼ºå°‘ã€Œé€å¥ shift 0/1 é æ¸¬æ¨™ç±¤ã€è¼¸å‡ºæª”ï¼ˆR3-1ï¼šâœ… å·²ä¿®å¾©ï¼‰

å·²æ–°å¢é€å¥è¼¸å‡ºæª”ï¼š`knowSelect/output/<name>/metrics/shift_pred.jsonl`ï¼ˆç”± `CumulativeTrainer.test()` æ–¼æ¨è«–æ™‚è¨ˆç®—ä¸¦è½æª”ï¼‰ã€‚

### 6.4 ç¤¾åœ˜è¨ˆç®—ï¼ˆä»¥æ¯æ™‚é–“ç‰‡è¨ˆç®—ï¼‰ä¹‹èªæ„å·²ç¢ºèªåˆç†ï¼ˆR2-3ï¼šâœ…ï¼‰

ä½ å·²ç¢ºèªï¼š**node_id åŒä¸€ç¯€é»ä¸æœƒè·¨æ™‚é–“ç‰‡å­˜åœ¨**ï¼Œå› æ­¤ç›®å‰æ¯æ™‚é–“ç‰‡è¨ˆç®—ç¤¾åœ˜ä¸¦ä»¥ `node_id -> community_id` ä¿å­˜çš„åšæ³•åœ¨èªæ„ä¸Šåˆç†ï¼›æœ¬é …ä¸å†åˆ—ç‚ºç–‘æ…®ã€‚

---

## å…­ä¹‹ä¸€ã€ä»éœ€æ ¸å°ï¼ˆå»ºè­°ä½ ç¢ºèª/æˆ‘æ‰èƒ½ä¿è­‰ 100% ç¬¦åˆï¼‰

### éœ€è¦ä½ è£œå……çš„ç´°ç¯€ï¼ˆå¦å‰‡å¯¦ä½œä»æœ‰æ­§ç¾©ï¼‰

- **å€é–“ Top-3 çš„é‚Šç•Œæ˜¯å¦åŒ…å«ç«¯é»**ï¼ˆå”¯ä¸€ä»ä¸æ˜ç¢ºï¼‰ï¼š
  - æ˜¯å¦åŒ…å«ã€Œå‰ä¸€æ¬¡ shift ç•¶ä¸‹ã€é‚£ä¸€å¥ï¼Ÿ
  - æ˜¯å¦åŒ…å«ã€Œæœ¬æ¬¡ shift ç•¶ä¸‹ã€é‚£ä¸€å¥ï¼ˆè½‰ç§»å¥æœ¬èº«ï¼‰ï¼Ÿ
  - âœ… å·²ç¢ºèªï¼š**å€é–“åŒ…å«æœ¬æ¬¡ shiftï¼ˆå«ç«¯é»ï¼‰ï¼Œä¸åŒ…å«å‰ä¸€æ¬¡ shift**ï¼Œä»¥é¿å…åŒä¸€å¥åœ¨ç›¸é„°å€é–“é‡è¤‡ï¼›ç›®å‰ç¨‹å¼å·²æ¡ç”¨æ­¤è¦å‰‡ï¼ˆ`knowSelect/TAKE/CumulativeTrainer.py`ï¼‰ã€‚

---

## ä¸ƒã€æ”¹é€²å»ºè­°ï¼ˆä¾å„ªå…ˆç´šï¼‰

### P0ï¼ˆç›´æ¥å½±éŸ¿ã€Œæ˜¯å¦ç¬¦åˆéœ€æ±‚ã€ï¼‰

- **æ˜ç¢ºåŒ– Top-3 çš„å®šç¾©ä¸¦èª¿æ•´è¼¸å‡º**ï¼š
  - é¸é … Aï¼šTop-3 = ã€Œæ•´æ®µå°è©±å…§æ‰€æœ‰å¥å­ã€ä¸­å¿ƒæ€§å‰ 3
  - é¸é … Bï¼šTop-3 = ã€Œè©²æ™‚é–“ç‰‡å…§æ‰€æœ‰ç¯€é»ã€ä¸­å¿ƒæ€§å‰ 3
  - é¸é … Cï¼šTop-3 = ã€Œè¢«é æ¸¬ç‚º shift çš„å¥å­é›†åˆã€ä¸­å¿ƒæ€§å‰ 3ï¼ˆç¾æ³ï¼‰
- **æŠŠã€Œè½‰ç§»å¥ã€ä»¥å–®ä¸€æ¬„ä½è¼¸å‡º**ï¼ˆä¾‹å¦‚ `shift_sentence`ã€`shift_node_id`ã€`shift_centrality`ï¼‰ï¼Œä¸¦ä¿ç•™ Top-3 ä½œç‚ºè¼”åŠ©è³‡è¨Šï¼Œé¿å…åªèƒ½å¾ list æ¨å›ã€‚

### P1ï¼ˆæå‡å¯ç”¨æ€§èˆ‡å¯è¿½æº¯ï¼‰

- **åœ¨ `shift_top3.jsonl` ä¸­åŠ å…¥æ›´å¤šå®šä½è³‡è¨Š**ï¼šä¾‹å¦‚ `turn_id`ã€`query_id`ï¼ˆç›®å‰åªæœ‰ node_id èˆ‡å¥å­æ–‡å­—ï¼‰ï¼Œä»¥ä¾¿å›æº¯åˆ°åŸå§‹è³‡æ–™åˆ—ã€‚
- **åœ¨ä¸­å¿ƒæ€§ CSV è¼¸å‡ºä¸­å›ºå®šæª”åè¦ç¯„èˆ‡æ–‡ä»¶èªªæ˜**ï¼šæ˜ç¢ºæŒ‡å‡º `alpha_1.5/tiage_0.csv ... tiage_9.csv` çš„å«ç¾©ã€‚

### P2ï¼ˆå·¥ç¨‹æ²»ç†ä¸€è‡´æ€§ï¼‰

- å°‡ã€Œä¸€éµæµç¨‹ã€çµ±ä¸€æ”¶æ–‚åˆ° `scripts/run_tiage_pipeline.sh`ï¼ˆç›®å‰å¦æœ‰ `run_tiage_with_timestamp.py`ï¼Œä¸”å…¶è¡Œç‚ºèˆ‡è…³æœ¬è¦ç¯„å¯èƒ½ä¸ä¸€è‡´ï¼‰ï¼Œä¸¦åœ¨ `scripts/README.md` ä»¥ç¹é«”ä¸­æ–‡æ¸…æ¥šåˆ—å‡ºè¼¸å…¥/è¼¸å‡ºä½ç½®èˆ‡æª”æ¡ˆèªªæ˜ã€‚

---

## å…«ã€çµè«–

- **å·²å®Œæˆï¼ˆç¬¦åˆåº¦é«˜ï¼‰**ï¼š
  - DGCN3 ä¸­å¿ƒæ€§åŒ¯å‡ºï¼šå·²èƒ½è¼¸å‡º **æ‰€æœ‰ 10 å€‹æ™‚é–“ç‰‡**ï¼Œä¸” CSV æ ¼å¼ç¬¦åˆã€Œå…©æ¬„ã€ç„¡è¡¨é ­ã€ã€‚
  - TAKE èåˆä¸­å¿ƒæ€§ + ç¤¾åœ˜ï¼šå·²æŠŠçµæ§‹ç‰¹å¾µæ³¨å…¥ TopicShift åˆ¤åˆ¥å™¨ã€‚
  - shift æŒ‡æ¨™ï¼šå·²è¨ˆç®—ä¸¦è½æª” Precision/Recall/F1ï¼Œä¸”æä¾›è®€å–å ±å‘Šè…³æœ¬ã€‚
- **ä¸»è¦å¾…æ”¹é€²ï¼ˆå½±éŸ¿éœ€æ±‚æ–‡å­—ä¸€è‡´æ€§ï¼‰**ï¼š
  - ã€Œä¸­å¿ƒæ€§æ’åå‰ 3 é—œéµå¥å­ã€ç›®å‰çš„ Top-3 å®šç¾©ï¼Œå¯èƒ½èˆ‡éœ€æ±‚æ–‡æª”èªæ„ä¸ä¸€è‡´ã€‚
  - ã€Œç™¼ç”Ÿè½‰ç§»çš„å¥å­ã€ç›®å‰æœªç¨ç«‹æ¬„ä½è½æª”ï¼ˆåƒ…ä»¥ Top-3 list å½¢å¼å‘ˆç¾ï¼‰ã€‚
  - è·¯å¾‘å‘½åèˆ‡éœ€æ±‚æ–‡æª”æœ‰å‡ºå…¥ï¼ˆ`DGCN3/Centrality/` vs `demo/DGCN3/Centrality/`ï¼‰ï¼Œéœ€åœ¨æ–‡ä»¶ä¸­æ˜ç¢ºåŒ–ã€‚

